<!DOCTYPE HTML>
<html lang="en">

<head>
    <title>Bunny</title>
    <meta charset="UTF-8" />
</head>

<script type="text/javascript" src="./Common/webgl-utils.js"></script>
<script type="text/javascript" src="./Common/initShaders.js"></script>
<script type="text/javascript" src="./Common/MV.js"></script>
<script type="text/javascript" src="./bunny.js"></script>
<script type="text/javascript" src="./drawBunny.js"></script>

<script id="vertex-shader" type="x-shader/x-vertex">

    attribute vec3 vPosition;
    attribute vec3 normal;

    // The transformation matrix
    uniform mat4 model;

    // World
    uniform vec3 view;

    // Light source
    uniform vec3 pointLightPosition;

    // pass to fragment shader
    varying vec3 vNormal;

    varying vec3 vSurfaceToLight;
    varying vec3 vSurfaceToView;

    void
    main()
    {

        gl_Position = model * vec4(vPosition, 1.0);

        vNormal = mat3(model) * normal;
        
        vSurfaceToLight = pointLightPosition - vec3(gl_Position);

        //vSurfaceToView = cross(pointLightPosition, vec3(gl_Position));
        vSurfaceToView = view - vec3(gl_Position);

    }
</script>

<script id="fragment-shader" type="x-shader/x-fragment">

    precision mediump float;

    uniform vec3 color;

    varying vec3 vSurfaceToLight;
    varying vec3 vNormal;
    varying vec3 vSurfaceToView;

    void
    main()
    {
        
        vec3 adjustedNormal = normalize(vNormal);
        
        vec3 surfaceToLightDirection = normalize(vSurfaceToLight);
        vec3 surfaceToViewDirection = normalize(vSurfaceToView);
        vec3 halfVector = normalize(surfaceToLightDirection + surfaceToViewDirection);

        float light = dot(adjustedNormal, surfaceToLightDirection);
        float specular = dot(adjustedNormal, halfVector);

        gl_FragColor = vec4(color + adjustedNormal * 0.1, 1);

        gl_FragColor.rgb *= light;
        gl_FragColor.rgb += specular;
    }
    
</script>

<style>
    canvas {
        margin: auto;
        display: block;
    }
</style>

<body oncontextmenu="return false;">
    <canvas id="gl-canvas" width="860" height="860">>
    </canvas>
</body>

</html>